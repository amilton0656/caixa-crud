{% extends 'base.html' %}

{% block title %}Obras{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">Obras</h1>
    <div class="btn-group" role="group">
        <button class="btn btn-outline-dark" type="button" data-bs-toggle="collapse" data-bs-target="#filtrosObras" aria-expanded="{{ show_filters|yesno:'true,false' }}" aria-controls="filtrosObras">Filtros</button>
        <a class="btn btn-outline-secondary" href="{% url 'obras:export_pdf' %}">Gerar PDF</a>
        <a class="btn btn-outline-success" href="{% url 'obras:export_excel' %}">Gerar Excel</a>
        <a class="btn btn-primary" href="{% url 'obras:create' %}">Nova obra</a>
    </div>
</div>
<div class="collapse mb-3{% if show_filters %} show{% endif %}" id="filtrosObras">
    <div class="card card-body">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-md-6">
                <label class="form-label" for="filtroBusca">Busca</label>
                <input class="form-control" type="text" id="filtroBusca" name="busca" value="{{ filters.busca }}" placeholder="Buscar por nome">
            </div>
            <div class="col-12 d-flex justify-content-end gap-2">
                <a class="btn btn-outline-secondary" href="{% url 'obras:list' %}">Limpar</a>
                <button class="btn btn-primary" type="submit">Aplicar</button>
            </div>
        </form>
    </div>
</div>
<div class="table-responsive">
    <table class="table table-striped align-middle">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Endereco</th>
                <th>Municipio</th>
                <th class="text-center">Acoes</th>
            </tr>
        </thead>
        <tbody>
            {% for obra in obras %}
            <tr>
                <td>{{ obra.id }}</td>
                <td>{{ obra.nome }}</td>
                <td>{{ obra.endereco }}</td>
                <td>{{ obra.municipio }}</td>
                <td class="text-center">
                    <a class="btn btn-sm btn-outline-secondary" href="{% url 'obras:update' obra.pk %}">Editar</a>
                    <a class="btn btn-sm btn-outline-danger" href="{% url 'obras:delete' obra.pk %}">Excluir</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td class="text-center" colspan="5">Nenhuma obra cadastrada.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% if is_paginated %}
<nav aria-label="Paginacao" class="mt-3">
    <ul class="pagination justify-content-center mb-0">
        <li class="page-item{% if not page_obj.has_previous %} disabled{% endif %}">
            <a class="page-link" href="{% if page_obj.has_previous %}?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.previous_page_number }}{% else %}#{% endif %}" tabindex="-1">Anterior</a>
        </li>
        {% for num in page_obj.paginator.page_range %}
        <li class="page-item{% if page_obj.number == num %} active{% endif %}">
            <a class="page-link" href="?{% if querystring %}{{ querystring }}&{% endif %}page={{ num }}">{{ num }}</a>
        </li>
        {% endfor %}
        <li class="page-item{% if not page_obj.has_next %} disabled{% endif %}">
            <a class="page-link" href="{% if page_obj.has_next %}?{% if querystring %}{{ querystring }}&{% endif %}page={{ page_obj.next_page_number }}{% else %}#{% endif %}">Proxima</a>
        </li>
    </ul>
</nav>
{% endif %}
{% endblock %}
